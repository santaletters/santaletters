      if (!response.ok) {
        const error = await response.json();
        console.error("‚ùå Charge subscription failed:", error);
        console.error("üìã Error details:", JSON.stringify(error, null, 2));
        
        // Handle recent charge warning
        if (error.recentCharge) {
          console.log("üö® RECENT CHARGE DETECTED - Showing confirmation popup");
          console.log("üö® Days since charge:", error.daysSinceCharge);
          console.log("üö® Last charge date:", error.lastChargeDate);
          setIsBillingInProgress(false);
          const confirmed = window.confirm(
            `‚ö†Ô∏è Recent Charge Detected\n\n` +
            `This subscription was charged ${error.daysSinceCharge} days ago.\n` +
            `Last charge: ${new Date(error.lastChargeDate).toLocaleDateString()}\n\n` +
            `Are you sure you want to charge again?`
          );
          
          console.log("üö® User confirmation result:", confirmed);
          
          if (confirmed) {
            // Retry with skipRecentChargeCheck = true
            console.log("‚úÖ User confirmed - Retrying with skipRecentChargeCheck = true");
            setIsBillingInProgress(true);
            const retryResponse = await fetch(API_URL + "/admin/charge-subscription", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: "Bearer " + publicAnonKey,
              },
              body: JSON.stringify({
                orderId: manualBillingOrder.orderId,
                customBillingDate: customBillingDate || null,
                skipRecentChargeCheck: true,
              }),
            });
            
            if (!retryResponse.ok) {
              const retryError = await retryResponse.json();
              console.error("‚ùå Retry also failed:", retryError);
              throw new Error(retryError.error || "Failed to charge subscription");
            }
            
            const result = await retryResponse.json();
            console.log("‚úÖ Charge successful:", result);
            await fetchOrders();
            setManualBillingOrder(null);
            setCustomBillingDate("");
            
            const successMsg = "‚úÖ Subscription Charged Successfully!\n\nPayment Intent: " + result.paymentIntentId + "\nAmount Charged: $" + result.amountCharged;
            const nextBillingMsg = result.nextBillingDate ? "\nNext Billing: " + new Date(result.nextBillingDate).toLocaleDateString() : "";
            alert(successMsg + nextBillingMsg + "\n\nCustomer has been notified via email.");
            return;
          } else {
            console.log("‚ùå User canceled - Not charging");
            setManualBillingOrder(null);
            setCustomBillingDate("");
            return;
          }
        }
        
        throw new Error(error.error || "Failed to charge subscription");
      }
